{"version":3,"file":"web-gpio-elements.js","sources":["src/web-gpio-element.ts","src/web-gpio-peripheral.ts"],"sourcesContent":["import { LitElement, customElement, html, property } from 'lit-element';\n\n@customElement('web-gpio')\nexport class WebGpioElement extends LitElement {\n  @property({ type: Boolean, reflect: true }) disable;\n  @property({ type: Object }) gpioAccess;\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    navigator.requestGPIOAccess().then((gpioAccess) => {\n      this.gpioAccess = gpioAccess;\n    }).catch((err) => {\n      console.log('This will not CHIRIMEN.', err);\n      this.disable = true;\n    });\n  }\n\n  render() {\n    return html `\n      <style>\n        :host {\n          display: block;\n        }\n        .message {\n          display: none;\n        }\n        :host([disable]) .message {\n          display: block;\n          font-size: 8px;\n          margin: 2em 4em;\n          color: orange;\n        }\n      </style>\n      <div class=\"message\">\n        <slot name=\"no-web-gpio\"></slot>\n      </div>\n      <slot id=\"sensors\"></slot>\n    `;\n  }\n}\n","import { LitElement, customElement, property } from 'lit-element';\n\n@customElement('web-gpio-peripheral')\nexport class WebGpioPeripheral extends LitElement {\n  @property({ type: Object }) gpioAccess;\n  @property({ type: Number }) port;\n  @property({ type: String }) mode;\n  @property({ type: Number }) interval = 100;\n  @property({ type: Boolean, hasChanged: (value: Boolean) => console.log(this.value) }) value;\n  @property({ type: Boolean, reflect: true }) disable;\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._init();\n  }\n\n  update(changedProperties) {\n    super.update(changedProperties);\n    if (changedProperties.has('port')) {\n      this._init();\n    }\n  }\n\n  _init() {\n    if (!this.port) return;\n\n    navigator.requestGPIOAccess().then(async (gpioAccess) => {\n      this.gpioAccess = gpioAccess;\n      this._io = gpioAccess.ports.get(this.port);\n      io.export(this.mode);\n      if (this.mode === 'in') {\n        this._setValue(await this._io.read());\n        this._io.onchange = (val) => {\n          this._setValue(val);\n          this.dispatchEvent(new CustomEvent('value-changed', {detail: { value: val }}));\n        };\n      }\n    }).catch((err) => {\n      this.disable = true;\n      console.warn('INIT ERROR', err);\n    });\n  }\n\n  _setValue(value) {\n    this.value = value === 1;\n  }\n}\n"],"names":["this"],"mappings":"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"}